<!DOCTYPE html>

<html lang="de">
  <head>
    <meta charset="utf-8">
    <title>RBA - Better Battle Files</title>
    <link rel="stylesheet" type="text/css" href="style.css">
  </head>
  <body>
    <header>
      <h2>RBA BetterBattleFiles</h2>
    </header>
    <main>
      <input class="help-btn" type="button" value="?" onclick="document.querySelector('.help').classList.toggle('hidden')">
      <div class="help hidden">
        <h3>Variables</h3>
        <ul>
          <li>
            %BATTLEID%
            <ul>
              <li>ID des Battles, bspw. <b>26980</b></li>
            </ul>
          </li>
          <li>
            %HERAUSFORDERER%
            <ul>
              <li>Herausforderer des Battles</li>
            </ul>
          </li>
          <li>
            %HERAUSFORDERER_PUNKTE%
            <ul>
              <li>Punkte an den Herausforderer</li>
            </ul>
          </li>
          <li>
            %GEGNER%
            <ul>
              <li>Gegner des Battles</li>
            </ul>
          </li>
          <li>
            %GEGNER_PUNKTE%
            <ul>
              <li>Punkte an den Gegner</li>
            </ul>
          </li>
        </ul>
        <ul>
          <li>
            %RUNDE_MC%
            <ul>
              <li>Interpret der Runde</li>
            </ul>
          </li>
          <li>
            %RUNDE_GEGNER%
            <ul>
              <li>Gegner der Runde (bezogen auf den Interpreten der heruntergeladenen Datei)</li>
            </ul>
          </li>
          <li>
            %RUNDE_NAME%
            <ul>
              <li>Name der Runde: HR, RR oder BEAT</li>
            </ul>
          </li>
          <li>
            %RUNDE_NUMMER%
            <ul>
              <li>Nummer der Runde: 1, 2 oder 3</li>
            </ul>
          </li>
          <li>
            %RUNDE_ID%
            <ul>
              <li>ID der Runde: 1 bis 9</li>
            </ul>
          </li>
          <li>
            %DATUM%
            <ul>
              <li>Einzeln: %YYYY%, %MM% und %DD%</li>
            </ul>
          </li>
          <li>
            %ZEIT%
            <ul>
              <li>Einzeln: %hh%, %mm, %ss, %ffffff</li>
            </ul>
          </li>
        </ul>
      </div>
      <section> <!-- on/off -->
        <div class="setting-wrapper horizontal">
          <label>Deaktivieren</label>
          <input class="toggle-btn active" type="button" value="" onclick="toggleExtension(event.target)">
        </div>
      </section>
      <section> <!-- file -->
        <div class="setting-wrapper vertical">
          <label>Dateiname</label>
          <input name="template_filename" onchange="setConfigOption(event.target.name, event.target.value)" class="configOption" type="text">
        </div>
      </section>
      <section> <!-- album -->
        <div class="setting-wrapper vertical">
          <label>Albumtitel</label>
          <input name="template_albumtitle" onchange="setConfigOption(event.target.name, event.target.value)" class="configOption" type="text">
        </div>
        <div class="setting-wrapper vertical">
          <label>Albuminterpret</label>
          <input name="template_albumartist" onchange="setConfigOption(event.target.name, event.target.value)" class="configOption" type="text">
        </div>
      </section>
      <section> <!-- song -->
        <div class="setting-wrapper vertical">
          <label>Titel</label>
          <input name="template_title" onchange="setConfigOption(event.target.name, event.target.value)" class="configOption" type="text">
        </div>
        <div class="setting-wrapper vertical">
          <label>Untertitel</label>
          <input name="template_subtitle" onchange="setConfigOption(event.target.name, event.target.value)" class="configOption" type="text">
        </div>
        <div class="setting-wrapper vertical">
          <label>Tracknummer</label>
          <input name="template_tracknmbr" onchange="setConfigOption(event.target.name, event.target.value)" class="configOption" type="text">
        </div>
        <div class="setting-wrapper vertical">
          <label>Interpret</label>
          <input name="template_artist" onchange="setConfigOption(event.target.name, event.target.value)" class="configOption" type="text">
        </div>
        <div class="setting-wrapper vertical">
          <label>Genre (mehrere mit '||' trennen)</label>
          <input name="template_genre" onchange="setConfigOption(event.target.name, event.target.value)" class="configOption" type="text">
        </div>
        <div class="setting-wrapper vertical">
          <label>Sprache</label>
          <input name="template_language" onchange="setConfigOption(event.target.name, event.target.value)" class="configOption" type="text">
        </div>
      </section>
      <section> <!-- reset -->
        <div></div>
        <div class="setting-wrapper horizontal reverse">
          <input class="click-btn" type="button" value="zurÃ¼cksetzen" onclick="resetConfig()">
        </div>
      </section>
    </main>
    <script src="config.js"></script>
    <script src="settings.js"></script>
    <script>
      //  set values of all inputs by their config value
      function setConfigValues(){
        //  set default config if config is empty
        getConfig((cfg) =>{
          if(Object.keys(cfg).length < 1)
            setConfigDefaults();
          //  text / number inputs
          const configOptionElements = document.querySelectorAll(".configOption");
          for(let el of configOptionElements){
            getConfigOption(el.name, (val) =>{
              if(val)
                el.value = val;
            });
          }

          //  activated / deactivated button, + set class
          const activeBtnElement = document.querySelector(".toggle-btn");
          getConfigOption("extensionIsActive", (val) =>{
            if(val != activeBtnElement.classList.contains("active"))
              toggleExtension(activeBtnElement);
          });
        });
      }
      
      //  toggle class for the activated / deactivated button and save it to config
      function toggleExtension(el){
        el.classList.toggle("active");
        let text = "Aktivieren";
        if(el.classList.contains("active"))
          text = "Deaktivieren";
        el.previousElementSibling.innerHTML = text;
        setConfigOption("extensionIsActive", el.classList.contains("active"));
      }
      
      //  clear config and set it to it's defaults
      function resetConfig(){
        clearConfig();
        setConfigDefaults();
        setConfigValues();
      }
      
      //  set config values on start
      setConfigValues();
    </script>
  </body>
</html>